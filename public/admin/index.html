<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Menu Digital</title>    
    <link rel="icon" type="image/x-icon" href="../assets/images/icon.png"/>
    <link rel="icon" href="../assets/images/icon.png" type="image/png" sizes="16x16">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> -->
    <!-- Vue 3 (ESM Browser build para módulos) -->
    <script type="importmap">
        {
          "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
          }
        }
    </script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- JQUERY (Requerido para Toastr) -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- TOASTR (Notificaciones) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- SWEETALERT2 (Alertas Modales) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- DATATABLES CSS/JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

    <link rel="stylesheet" href="../assets/css/main.css">
</head>

<body class="bg-slate-50 dark:bg-slate-900 transition-colors duration-300">

    <div id="app" class="h-screen flex flex-col text-slate-800 dark:text-slate-100" v-cloak>

        <!-- LOGIN SCREEN (Simulado) -->
        <div v-if="!isAuthenticated" class="flex-1 flex items-center justify-center bg-slate-900 bg-opacity-95">
            <div class="bg-white dark:bg-slate-800 p-10 rounded-2xl shadow-2xl w-full max-w-md transform transition-all hover:scale-105 duration-300 border dark:border-slate-700">
                <div class="text-center mb-8">
                    <div
                        class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl shadow-lg">
                        <i class="fa-solid fa-utensils"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-slate-800 dark:text-white">Bienvenido</h2>
                    <p class="text-slate-500 dark:text-slate-400 mt-2">Panel de Control del Menú Digital</p>
                </div>
                <form @submit.prevent="login">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Usuario</label>
                            <input v-model="credentials.username" type="text" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition dark:text-white" placeholder="admin">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Contraseña</label>
                            <input v-model="credentials.password" type="password" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition dark:text-white" placeholder="******">
                        </div>
                        <button type="submit" class="w-full bg-primary hover:bg-primaryDark text-white font-bold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 transform active:scale-95">
                            Iniciar Sesión
                        </button>
                    </div>
                    <p v-if="loginError" class="text-red-500 text-sm mt-4 text-center bg-red-50 dark:bg-red-900/20 py-2 rounded">{{
                        loginError }}
                    </p>
                </form>
            </div>
        </div>

        <div v-if="isAuthenticated">
            <!-- ADMIN DASHBOARD LAYOUT -->
            <div v-else
                class="flex h-screen overflow-hidden bg-slate-50 dark:bg-slate-900 transition-colors duration-300">

                <!-- SIDEBAR -->
                <aside class="bg-sidebar text-slate-300 flex flex-col transition-all duration-300 shadow-xl z-30 fixed md:relative h-full"
                    :class="[
                    collapsed ? 'md:w-20' : 'md:w-72',
                    mobileMenuOpen ? 'translate-x-0 w-64' : '-translate-x-full md:translate-x-0 w-64']">

                    <div class="h-20 flex items-center justify-center border-b border-slate-800">
                        <div class="flex items-center space-x-3" v-if="!collapsed">
                            <i class="fa-solid fa-burger text-3xl text-primary"></i>
                            <div>
                                <!-- Nombre de App Dinámico -->
                                <h1 class="font-bold text-lg text-white leading-tight uppercase">
                                    {{ currentUserRole === 'superadmin' ? 'SUPER ADMIN' : (settings.appName || 'FOOD ADMIN') }}
                                </h1>
                            </div>
                        </div>
                        <i class="fa-solid fa-burger text-2xl text-primary" v-else></i>
                    </div>

                    <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
                        <!-- RENDERIZADO DINÁMICO DE MENÚ SEGÚN ROL -->
                        <template v-for="item in activeMenuItems" :key="item.id">
                            <div v-if="!item.children">
                                <a href="#" @click.prevent="navigate(item)" 
                                class="flex items-center px-4 py-3.5 rounded-xl transition-all duration-200 group"
                                :class="currentView === item.view ? 'bg-primary text-white shadow-lg' : 'hover:bg-slate-800 hover:text-white'">
                                    <i :class="item.icon" class="w-6 text-center text-lg" :class="currentView === item.view ? 'text-white' : 'text-slate-400'"></i>
                                    <span class="ml-3 font-medium" v-if="!collapsed">{{ item.label }}</span>
                                </a>
                            </div>
                            <div v-else>
                                <button @click="toggleSubmenu(item)" class="w-full flex items-center justify-between px-4 py-3.5 rounded-xl hover:bg-slate-800 hover:text-white text-slate-300 group">
                                    <div class="flex items-center">
                                        <i :class="item.icon" class="w-6 text-center text-lg text-slate-400 group-hover:text-white"></i>
                                        <span class="ml-3 font-medium" v-if="!collapsed">{{ item.label }}</span>
                                    </div>
                                    <i v-if="!collapsed" class="fa-solid fa-chevron-down text-xs transition-transform" :class="{'rotate-180': item.expanded}"></i>
                                </button>
                                <transition name="slide">
                                    <div v-if="item.expanded && !collapsed" class="pl-12 pr-2 space-y-1 mt-1">
                                        <a v-for="sub in item.children" :key="sub.id" href="#" @click.prevent="navigate(sub)"
                                        class="block py-2 px-4 rounded-lg text-sm"
                                        :class="currentView === sub.view ? 'text-primary bg-slate-800 font-semibold' : 'text-slate-400 hover:text-white hover:bg-slate-800/50'">
                                            {{ sub.label }}
                                        </a>
                                    </div>
                                </transition>
                            </div>
                        </template>
                    </nav>

                    <div class="p-4 border-t border-slate-800">
                        <button @click="logout"
                            class="flex items-center justify-center w-full py-2 px-4 rounded-lg border border-slate-700 hover:bg-red-500/20 hover:text-red-400 transition text-slate-400 text-sm">
                            <i class="fa-solid fa-right-from-bracket mr-2"></i>
                            <span v-if="!collapsed">Salir</span>
                        </button>
                    </div>
                </aside>

                <!-- BACKDROP: Fondo oscuro para mobile -->
                <div v-if="mobileMenuOpen" @click="mobileMenuOpen = false"
                    class="fixed inset-0 bg-black/50 z-20 md:hidden glass transition-opacity"></div>

                <!-- MAIN CONTENT AREA -->
                <div class="flex-1 flex flex-col h-screen overflow-hidden relative">

                    <!-- Top Header -->
                    <header
                        class="h-20 bg-white dark:bg-slate-800 shadow-sm flex items-center justify-between px-8 z-10 border-b dark:border-slate-700">
                        <!-- Botón Toggle actualizado -->
                        <button @click="toggleSidebar" class="text-slate-500 hover:text-primary"><i
                                class="fa-solid fa-bars-staggered text-2xl"></i></button>
                        <div class="flex items-center space-x-6">
                            <button @click="toggleTheme"
                                class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-yellow-400 flex items-center justify-center hover:bg-slate-200 transition">
                                <i class="fa-solid" :class="isDark ? 'fa-sun' : 'fa-moon'"></i>
                            </button>
                            <div class="flex items-center space-x-2">
                                <div class="text-right hidden md:block">
                                    <p class="text-sm font-bold text-slate-800 dark:text-white">Hola, {{ settings.adminName || username }}</p>
                                    <p class="text-xs text-slate-500">{{ currentUserRole === 'superadmin' ? 'Super Admin' : 'Gerente' }}</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-danger flex items-center justify-center text-white font-bold">
                                    F
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Content Scrollable -->
                    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-slate-50 dark:bg-slate-900 p-8 transition-colors duration-300">

                        <!-- === VISTAS SUPER ADMIN === -->
                        <div v-if="currentView === 'saas_clients'" class="space-y-6 animate-fade-in">
                            <div class="flex justify-between items-center">
                                <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Gestión de Negocios (SaaS)</h2>
                                <button @click="openSaasModal()" class="bg-primary hover:bg-primaryDark text-white px-6 py-2.5 rounded-xl shadow-lg transition"><i class="fa-solid fa-plus mr-2"></i> Registrar Negocio</button>
                            </div>

                            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                                <table class="w-full text-left">
                                    <thead class="bg-slate-50 dark:bg-slate-700 text-xs uppercase text-slate-500 dark:text-slate-300">
                                        <tr>
                                            <th class="p-4">Negocio</th>
                                            <th class="p-4">URL Slug</th>
                                            <th class="p-4">Plan</th>
                                            <th class="p-4 text-center">Estado</th>
                                            <th class="p-4 text-right">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100 dark:divide-slate-700">
                                        <tr v-for="biz in businesses" :key="biz._id" class="hover:bg-slate-50 dark:hover:bg-slate-700/50 transition">
                                            <td class="p-4 font-bold text-slate-800 dark:text-white">{{ biz.name }}</td>
                                            <td class="p-4 text-sm text-slate-500">
                                                <a :href="'/?slug='+biz.slug" target="_blank" class="px-3 py-1 rounded-full text-xs font-bold transition w-24 bg-green-100 text-green-700 hover:bg-green-200">{{ biz.slug }}</a>
                                            </td>
                                            <td class="p-4"><span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded uppercase font-bold">{{ biz.plan }}</span></td>
                                            <td class="p-4 text-center">
                                                <button @click="toggleStatus(biz)" class="px-3 py-1 rounded-full text-xs font-bold transition w-24"
                                                    :class="biz.active ? 'bg-green-100 text-green-700 hover:bg-green-200' : 'bg-red-100 text-red-700 hover:bg-red-200'">
                                                    {{ biz.active ? 'ACTIVO' : 'BLOQUEADO' }}
                                                </button>
                                            </td>
                                            <td class="p-4 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <!-- Botón Editar -->
                                                    <button @click="openSaasModal(biz)" class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:bg-blue-100 hover:text-blue-600 transition flex items-center justify-center">
                                                        <i class="fa-solid fa-pen text-xs"></i>
                                                    </button>
                                                    <!-- Botón Eliminar -->
                                                    <button @click="deleteBusiness(biz._id)" class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:bg-red-100 hover:text-red-600 transition flex items-center justify-center">
                                                        <i class="fa-solid fa-trash text-xs"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>


                        <!-- === VISTAS NEGOCIO === -->
                        <!-- VIEW: DASHBOARD -->
                        <div v-if="currentView === 'dashboard'" class="space-y-8 animate-fade-in">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Panel de Control</h2>
                                <p class="text-slate-500 dark:text-slate-400">Resumen general de tu negocio hoy.</p>
                            </div>

                            <!-- KPI Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div v-for="kpi in kpis" :key="kpi.label"
                                    class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-100 dark:border-slate-700 flex items-center hover:shadow-md transition-all">
                                    <div
                                        :class="`w-14 h-14 rounded-2xl flex items-center justify-center text-2xl mr-4 ${kpi.colorBg} dark:bg-opacity-20 ${kpi.colorText}`">
                                        <i :class="kpi.icon"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white">{{ kpi.value }}
                                        </h3>
                                        <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">{{ kpi.label
                                            }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Gráficos / Tablas (Placeholder) -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div
                                    class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                                    <h3 class="font-bold text-lg text-slate-800 dark:text-white mb-4">Ventas Recientes
                                    </h3>
                                    <div
                                        class="h-64 flex items-end justify-between space-x-2 px-4 pb-2 border-b border-slate-100 dark:border-slate-700">
                                        <!-- Fake Chart Bars -->
                                        <div v-for="h in [40, 65, 30, 80, 55, 90, 45]" :style="`height: ${h}%`"
                                            class="w-full bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity relative group">
                                            <div
                                                class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition">
                                                {{h}}%</div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between text-xs text-slate-400 mt-2 px-2">
                                        <span>Lun</span><span>Mar</span><span>Mie</span><span>Jue</span><span>Vie</span><span>Sab</span><span>Dom</span>
                                    </div>
                                </div>
                                <div
                                    class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                                    <h3 class="font-bold text-lg text-slate-800 dark:text-white mb-4">Más Vendidos</h3>
                                    <ul class="space-y-4">
                                        <li v-for="i in 4" :key="i" class="flex items-center">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-slate-200 dark:bg-slate-700 mr-3 overflow-hidden">
                                                <img :src="`https://plus.unsplash.com/premium_photo-1673108852141-e8c3c22a4a22?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D`"
                                                    class="w-full h-full object-cover">
                                            </div>
                                            <div class="flex-1">
                                                <p class="text-sm font-bold text-slate-800 dark:text-slate-200">Producto
                                                    Top
                                                    #{{i}}</p>
                                                <p class="text-xs text-slate-500 dark:text-slate-400">24 vendidos hoy
                                                </p>
                                            </div>
                                            <span class="text-primary font-bold text-sm">$120</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- VIEW: MEDIOS (Galería) -->
                        <div v-if="currentView === 'media'" class="h-full flex flex-col animate-fade-in">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Biblioteca de Medios
                                    </h2>
                                    <p class="text-slate-500 dark:text-slate-400">Gestiona tus imágenes y videos</p>
                                </div>

                                <!-- Botón Subir -->
                                <div class="flex items-center gap-3">
                                    <input type="file" ref="fileInput" @change="uploadFile" class="hidden"
                                        accept="image/*,video/*">
                                    <button @click="$refs.fileInput.click()"
                                        class="bg-primary hover:bg-primaryDark text-white px-6 py-2.5 rounded-xl shadow-lg transition flex items-center">
                                        <i class="fa-solid fa-cloud-arrow-up mr-2"></i>
                                        <span v-if="isUploading">Subiendo...</span>
                                        <span v-else>Subir Nuevo</span>
                                    </button>
                                </div>
                            </div>

                            <!-- BARRA DE FILTROS -->
                            <div
                                class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 mb-6 flex flex-wrap gap-4 items-center">
                                <!-- Buscador Nombre -->
                                <div class="flex-1 min-w-[200px]">
                                    <div class="relative">
                                        <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                                        <input v-model="mediaFilters.search" type="text"
                                            placeholder="Buscar por nombre..."
                                            class="w-full pl-10 pr-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                                    </div>
                                </div>

                                <!-- Filtro Tipo -->
                                <div class="min-w-[150px]">
                                    <select v-model="mediaFilters.type"
                                        class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-sm appearance-none">
                                        <option value="all">Todos los tipos</option>
                                        <option value="image">Imágenes</option>
                                        <option value="video">Videos</option>
                                    </select>
                                </div>

                                <!-- Filtro Fecha -->
                                <div class="min-w-[150px]">
                                    <input v-model="mediaFilters.date" type="date"
                                        class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                                </div>

                                <!-- Botón Limpiar -->
                                <button @click="clearMediaFilters"
                                    class="text-slate-500 hover:text-red-500 dark:text-slate-400 dark:hover:text-red-400 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition"
                                    title="Limpiar filtros">
                                    <i class="fa-solid fa-filter-circle-xmark text-lg"></i>
                                </button>
                            </div>

                            <!-- GRID DE RESULTADOS -->
                            <div
                                class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex-1 overflow-y-auto">

                                <!-- Estado vacío -->
                                <div v-if="filteredMedia.length === 0" class="text-center text-slate-400 py-10">
                                    <i class="fa-solid fa-magnifying-glass text-4xl mb-3 opacity-50"></i>
                                    <p>No se encontraron archivos.</p>
                                    <button v-if="mediaFiles.length > 0" @click="clearMediaFilters"
                                        class="mt-2 text-primary hover:underline text-sm">Limpiar filtros</button>
                                </div>

                                <!-- Grid -->
                                <div class="grid grid-cols-2 md:grid-cols-6 lg:grid-cols-11 gap-4">
                                    <div v-for="img in filteredMedia" :key="img.name"
                                        class="aspect-square relative group rounded-xl overflow-hidden cursor-pointer border border-slate-200 dark:border-slate-600 bg-slate-100 dark:bg-slate-700">

                                        <!-- Renderizado Condicional: Video vs Imagen -->
                                        <video v-if="isVideo(img.name)" :src="img.url"
                                            class="w-full h-full object-cover"></video>
                                        <img v-else :src="img.url"
                                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">

                                        <!-- Icono de Video Overlay -->
                                        <div v-if="isVideo(img.name)"
                                            class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1 w-6 h-6 flex items-center justify-center text-xs">
                                            <i class="fa-solid fa-video"></i>
                                        </div>

                                        <!-- Overlay Actions -->
                                        <div
                                            class="absolute inset-0 bg-slate-900/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-3">
                                            <button @click="deleteFile(img.name)"
                                                class="w-10 h-10 bg-white rounded-full text-red-500 hover:bg-red-500 hover:text-white transition flex items-center justify-center shadow-lg"
                                                title="Eliminar">
                                                <i class="fa-solid fa-trash-can"></i>
                                            </button>
                                            <button @click="copyToClipboard(img.url)"
                                                class="w-10 h-10 bg-white rounded-full text-blue-500 hover:bg-blue-500 hover:text-white transition flex items-center justify-center shadow-lg"
                                                title="Copiar URL">
                                                <i class="fa-solid fa-link"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- VIEW: PUBLICIDAD / BANNERS -->
                        <div v-if="currentView === 'ads'" class="space-y-6 animate-fade-in">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Publicidad y Banners
                                    </h2>
                                    <p class="text-slate-500 dark:text-slate-400">Promociones visibles en el menú
                                        principal
                                    </p>
                                </div>
                                <button @click="openBannerModal()"
                                    class="bg-secondary hover:bg-emerald-600 text-white px-6 py-2.5 rounded-xl shadow-lg shadow-emerald-500/30 transition flex items-center">
                                    <i class="fa-solid fa-plus mr-2"></i> Crear Banner
                                </button>
                            </div>

                            <div v-if="banners.length === 0" class="text-center py-12 text-slate-400">
                                <i class="fa-solid fa-bullhorn text-4xl mb-3 opacity-50"></i>
                                <p>No tienes banners activos.</p>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <!-- Banner Card -->
                                <div v-for="banner in banners" :key="banner._id"
                                    class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden group hover:shadow-md transition">
                                    <div class="h-40 bg-slate-200 dark:bg-slate-700 relative overflow-hidden">
                                        <img :src="banner.imageUrl" class="w-full h-full object-cover">
                                        <div class="absolute top-4 right-4 text-xs font-bold px-2 py-1 rounded-md shadow-sm"
                                            :class="banner.active ? 'bg-green-500 text-white' : 'bg-slate-500 text-white'">
                                            {{ banner.active ? 'ACTIVO' : 'INACTIVO' }}
                                        </div>
                                    </div>
                                    <div class="p-6">
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="text-lg font-bold text-slate-800 dark:text-white">{{ banner.title
                                                }}
                                            </h3>
                                            <div class="flex space-x-2">
                                                <button @click="openBannerModal(banner)"
                                                    class="text-slate-400 hover:text-primary"><i
                                                        class="fa-solid fa-pen"></i></button>
                                                <button @click="deleteBanner(banner._id)"
                                                    class="text-slate-400 hover:text-red-500"><i
                                                        class="fa-solid fa-trash"></i></button>
                                            </div>
                                        </div>
                                        <p class="text-slate-500 dark:text-slate-400 text-sm mb-4 line-clamp-2">{{
                                            banner.description }}</p>
                                        <div class="flex items-center text-xs text-slate-400">
                                            <i class="fa-regular fa-clock mr-1"></i>
                                            <span v-if="banner.expiresAt">Expira: {{ new
                                                Date(banner.expiresAt).toLocaleDateString() }}</span>
                                            <span v-else>Sin caducidad</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- VIEW: PRODUCTOS -->
                        <div v-if="currentView === 'products'" class="space-y-6 animate-fade-in">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Productos</h2>
                                    <p class="text-slate-500 dark:text-slate-400">Gestión de platillos y artículos</p>
                                </div>
                                <button @click="openProductModal(null, mediaFiles.length)" class="bg-primary hover:bg-primaryDark text-white px-6 py-2.5 rounded-xl shadow-lg transition flex items-center w-full md:w-auto justify-center">
                                    <i class="fa-solid fa-plus mr-2"></i> Nuevo Producto
                                </button>
                            </div>

                            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden p-4">
                                <!-- TABLA PARA DATATABLES -->
                                <table id="productsTable" class="w-full text-left display responsive nowrap" style="width:100%">
                                    <thead class="bg-slate-50 dark:bg-slate-700 text-slate-500 dark:text-slate-300 text-xs uppercase">
                                        <tr>
                                            <th>Imagen</th>
                                            <th>Nombre</th>
                                            <th>Precio</th>
                                            <th>Categorías</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Renderizado por DataTables -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- VIEW: CATEGORÍAS -->
                        <div v-if="currentView === 'categories'" class="space-y-6 animate-fade-in">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Categorías</h2>
                                    <p class="text-slate-500 dark:text-slate-400">Organiza tu menú en secciones</p>
                                </div>
                                <button @click="openCategoryModal(null, mediaFiles.length)"
                                    class="bg-secondary hover:bg-emerald-600 text-white px-6 py-2.5 rounded-xl shadow-lg transition flex items-center w-full md:w-auto justify-center">
                                    <i class="fa-solid fa-plus mr-2"></i> Nueva Categoría
                                </button>
                            </div>

                            <div v-if="categoriesList.length === 0" class="text-center py-12 text-slate-400">
                                <i class="fa-solid fa-layer-group text-4xl mb-3 opacity-50"></i>
                                <p>No tienes categorías creadas.</p>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                <div v-for="cat in categoriesList" :key="cat._id"
                                    class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col group hover:shadow-md transition">
                                    <div class="flex items-center justify-between mb-4">
                                        <div
                                            class="w-12 h-12 rounded-xl overflow-hidden bg-slate-100 dark:bg-slate-700">
                                            <img v-if="cat.image" :src="cat.image" class="w-full h-full object-cover">
                                            <div v-else
                                                class="w-full h-full flex items-center justify-center text-slate-400"><i
                                                    class="fa-solid fa-utensils"></i></div>
                                        </div>
                                        <div
                                            class="flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button @click="openCategoryModal(cat, mediaFiles.length)"
                                                class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:bg-primary hover:text-white transition flex items-center justify-center"><i
                                                    class="fa-solid fa-pen text-xs"></i></button>
                                            <button @click="deleteCategory(cat._id)"
                                                class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:bg-red-500 hover:text-white transition flex items-center justify-center"><i
                                                    class="fa-solid fa-trash text-xs"></i></button>
                                        </div>
                                    </div>
                                    <h3 class="font-bold text-lg text-slate-800 dark:text-white mb-1">{{ cat.name }}
                                    </h3>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 line-clamp-2 mb-3">{{
                                        cat.description || 'Sin descripción' }}</p>
                                    <div
                                        class="mt-auto pt-3 border-t border-slate-100 dark:border-slate-700 flex justify-between items-center">
                                        <span
                                            class="text-xs font-medium px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300">{{
                                            cat.active ? 'Visible' : 'Oculta' }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- VIEW: COMPLEMENTOS / ADDONS -->
                        <div v-if="currentView === 'addons'" class="space-y-6 animate-fade-in">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Complementos y Extras
                                    </h2>
                                    <p class="text-slate-500 dark:text-slate-400">Grupos de opciones (Salsas, Tamaños,
                                        etc.)
                                    </p>
                                </div>
                                <button @click="openAddonModal()"
                                    class="bg-secondary hover:bg-emerald-600 text-white px-6 py-2.5 rounded-xl shadow-lg transition flex items-center w-full md:w-auto justify-center">
                                    <i class="fa-solid fa-plus mr-2"></i> Nuevo Grupo
                                </button>
                            </div>

                            <div v-if="addonsList.length === 0" class="text-center py-12 text-slate-400">
                                <i class="fa-solid fa-list-check text-4xl mb-3 opacity-50"></i>
                                <p>No tienes grupos de complementos.</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div v-for="addon in addonsList" :key="addon._id"
                                    class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col overflow-hidden">
                                    <!-- Header Card -->
                                    <div
                                        class="p-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-700/30 flex justify-between items-start">
                                        <div>
                                            <h3 class="font-bold text-lg text-slate-800 dark:text-white">{{ addon.name
                                                }}
                                            </h3>
                                            <div class="flex gap-2 mt-1">
                                                <span class="text-xs px-2 py-0.5 rounded font-medium"
                                                    :class="addon.required ? 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400' : 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400'">
                                                    {{ addon.required ? 'Obligatorio' : 'Opcional' }}
                                                </span>
                                                <span
                                                    class="text-xs px-2 py-0.5 rounded bg-slate-200 dark:bg-slate-600 text-slate-600 dark:text-slate-300">
                                                    Max: {{ addon.maxOptions }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button @click="openAddonModal(addon)"
                                                class="text-slate-400 hover:text-primary p-1"><i
                                                    class="fa-solid fa-pen"></i></button>
                                            <button @click="deleteAddon(addon._id)"
                                                class="text-slate-400 hover:text-red-500 p-1"><i
                                                    class="fa-solid fa-trash"></i></button>
                                        </div>
                                    </div>
                                    <!-- Options List Preview -->
                                    <div class="p-5 flex-1">
                                        <p class="text-xs text-slate-400 uppercase font-bold mb-3 tracking-wider">
                                            Opciones
                                            ({{ addon.options.length }})</p>
                                        <ul class="space-y-2">
                                            <li v-for="(opt, idx) in addon.options.slice(0, 4)" :key="idx"
                                                class="flex justify-between text-sm text-slate-600 dark:text-slate-300">
                                                <span>{{ opt.name }}</span>
                                                <span v-if="opt.priceExtra > 0"
                                                    class="text-emerald-600 dark:text-emerald-400 font-medium">+${{
                                                    opt.priceExtra }}</span>
                                                <span v-else class="text-slate-400 text-xs">Gratis</span>
                                            </li>
                                            <li v-if="addon.options.length > 4"
                                                class="text-xs text-center text-slate-400 pt-1">
                                                +{{ addon.options.length - 4 }} más...
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CONFIGURACIÓN VIEW -->
                        <div v-if="currentView === 'settings'" class="space-y-6 animate-fade-in max-w-4xl mx-auto">
                            <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Configuración del Sistema</h2>
                            
                            <!-- Tarjeta: General / Negocio -->
                            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                                <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                                    <h3 class="font-bold text-lg text-slate-800 dark:text-white flex items-center">
                                        <i class="fa-solid fa-store mr-2 text-primary"></i> 
                                        {{ settings.role === 'superadmin' ? 'Plataforma SaaS' : 'Mi Negocio' }}
                                    </h3>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Personaliza la identidad visual e información.</p>
                                </div>
                                
                                <div class="p-6">
                                    <!-- Layout Flex: Avatar Izquierda - Inputs Derecha -->
                                    <div class="flex flex-col md:flex-row gap-8">
                                        
                                        <!-- SECCIÓN AVATAR (Solo para Negocios) -->
                                        <div v-if="settings.role === 'admin_negocio'" class="flex flex-col items-center space-y-3">
                                            <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Logo del Negocio</label>
                                            
                                            <div class="relative group cursor-pointer w-32 h-32">
                                                <!-- Input Oculto -->
                                                <input type="file" ref="avatarInput" @change="uploadAvatar" class="hidden" accept="image/*">
                                                
                                                <!-- Contenedor Visual -->
                                                <div @click="$refs.avatarInput.click()" 
                                                    class="w-full h-full rounded-2xl border-2 border-dashed border-slate-300 dark:border-slate-600 flex items-center justify-center overflow-hidden hover:border-primary hover:bg-slate-50 dark:hover:bg-slate-700 transition relative bg-slate-50 dark:bg-slate-800 shadow-sm">
                                                    
                                                    <!-- Imagen Preview -->
                                                    <img v-if="settings.avatar" :src="settings.avatar" class="w-full h-full object-cover">
                                                    
                                                    <!-- Placeholder (Si no hay imagen) -->
                                                    <div v-else class="text-slate-400 flex flex-col items-center text-center p-2">
                                                        <i class="fa-regular fa-image text-3xl mb-1"></i>
                                                        <span class="text-[10px] font-medium uppercase">Subir Logo</span>
                                                    </div>

                                                    <!-- Loading Overlay -->
                                                    <div v-if="isUploadingAvatar" class="absolute inset-0 bg-white/80 dark:bg-black/60 flex items-center justify-center z-10">
                                                        <i class="fa-solid fa-circle-notch fa-spin text-primary text-xl"></i>
                                                    </div>

                                                    <!-- Hover Overlay (Editar) -->
                                                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center text-white backdrop-blur-[1px]">
                                                        <i class="fa-solid fa-camera text-xl"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <p class="text-xs text-slate-400 text-center w-32">Click para cambiar imagen</p>
                                        </div>

                                        <!-- SECCIÓN INPUTS -->
                                        <div class="flex-1 space-y-4">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <!-- Nombre (Compartido) -->
                                                <div class="md:col-span-2">
                                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                                        {{ settings.role === 'superadmin' ? 'Nombre Plataforma' : 'Nombre del Restaurante' }}
                                                    </label>
                                                    <input v-model="settings.appName" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                                </div>

                                                <!-- Campos SOLO para Negocios -->
                                                <div v-if="settings.role === 'admin_negocio'">
                                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Teléfono / WhatsApp</label>
                                                    <input v-model="settings.phone" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                                </div>

                                                <div v-if="settings.role === 'admin_negocio'">
                                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Correo de Contacto</label>
                                                    <input v-model="settings.ownerEmail" type="email" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                                </div>

                                                <div v-if="settings.role === 'admin_negocio'">
                                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Moneda</label>
                                                    <input v-model="settings.currency" type="text" placeholder="MXN" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                                </div>

                                                <div v-if="settings.role === 'admin_negocio'">
                                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Color Principal</label>
                                                    <div class="flex gap-2 items-center">
                                                        <div class="relative overflow-hidden w-10 h-10 rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm">
                                                            <input v-model="settings.primaryColor" type="color" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer border-none p-0">
                                                        </div>
                                                        <input v-model="settings.primaryColor" type="text" class="flex-1 px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary uppercase font-mono text-sm">
                                                    </div>
                                                </div>

                                                <!-- Campo SOLO SuperAdmin -->
                                                <div v-if="settings.role === 'superadmin'">
                                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Nombre Admin Sistema</label>
                                                    <input v-model="settings.adminName" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                                </div>
                                            </div>
                                            
                                            <div class="flex justify-end pt-4">
                                                <button @click="saveSettings" class="bg-primary hover:bg-primaryDark text-white px-6 py-2.5 rounded-xl font-medium transition shadow-md flex items-center">
                                                    <i class="fa-solid fa-save mr-2"></i> Guardar Cambios
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tarjeta: Seguridad (Perfil) -->
                            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                                <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                                    <h3 class="font-bold text-lg text-slate-800 dark:text-white flex items-center">
                                        <i class="fa-solid fa-shield-halved mr-2 text-secondary"></i> Acceso
                                    </h3>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Credenciales de inicio de sesión.</p>
                                </div>
                                <div class="p-6 space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Usuario</label>
                                            <input v-model="profile.username" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Nueva Contraseña</label>
                                            <input v-model="profile.newPassword" type="password" placeholder="Dejar en blanco para no cambiar" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                                        </div>
                                    </div>
                                    <div class="flex justify-end pt-2">
                                        <button @click="saveProfile" class="bg-slate-800 hover:bg-black dark:bg-slate-700 dark:hover:bg-slate-600 text-white px-6 py-2.5 rounded-xl font-medium transition shadow-md">Actualizar Perfil</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </main>
                </div>
            </div>

            <!-- MODAL SAAS -->
            <div v-if="showSaasModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
                <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in border dark:border-slate-700">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800 dark:text-white">{{ editingBusiness ? 'Editar Negocio' : 'Nuevo Cliente SaaS' }}</h3>
                        <button @click="showSaasModal = false" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Nombre del Negocio</label>
                            <input v-model="saasForm.businessName" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        </div>
                        
                        <!-- Slug editable solo en modo edición -->
                        <div v-if="editingBusiness">
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">URL Slug (Identificador)</label>
                            <input v-model="saasForm.slug" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white font-mono text-sm">
                        </div>

                        <!-- Credenciales solo visibles al CREAR (o podrías hacer una sección aparte para resetear password) -->
                        <div v-if="!editingBusiness">
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Usuario Admin</label>
                            <input v-model="saasForm.username" type="text" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        </div>
                        <div >
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
                            <input v-model="saasForm.ownerEmail" type="email" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        </div>
                        <div v-if="!editingBusiness">
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Contraseña</label>
                            <input v-model="saasForm.password" type="password" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Plan</label>
                            <select v-model="saasForm.plan" class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                                <option value="free">Gratuito</option>
                                <option value="pro">Pro</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                        <button @click="showSaasModal = false" class="px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 rounded-lg">Cancelar</button>
                        <button @click="saveBusiness" class="px-4 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primaryDark">
                            {{ editingBusiness ? 'Guardar Cambios' : 'Registrar' }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- MODAL BANNERS -->
            <div v-if="showBannerModal"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
                <div
                    class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-11/12 md:w-full max-w-lg overflow-hidden animate-fade-in border dark:border-slate-700 flex flex-col max-h-[90vh]">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800 dark:text-white">{{ editingBanner ? 'Editar' :
                            'Nuevo'
                            }} Banner</h3>
                        <button @click="showBannerModal = false" class="text-slate-400 hover:text-red-500"><i
                                class="fa-solid fa-xmark text-xl"></i></button>
                    </div>

                    <div class="p-6 space-y-4 overflow-y-auto">
                        <!-- Image Selector -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Imagen del
                                Banner</label>
                            <div class="flex flex-col gap-3">

                                <!-- Direct Upload -->
                                <div class="relative">
                                    <input type="file" ref="bannerFileInput" @change="uploadBannerImage" class="hidden"
                                        accept="image/*">
                                </div>

                                <div v-if="bannerForm.imageUrl"
                                    class="h-40 w-full rounded-lg bg-slate-100 overflow-hidden border border-slate-200 dark:border-slate-600 relative group">
                                    <img :src="bannerForm.imageUrl" class="w-full h-full object-cover">
                                    <button @click="deleteImagePreviewBann()"
                                        class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 w-6 h-6 flex items-center justify-center shadow hover:bg-red-600"><i
                                            class="fa-solid fa-xmark"></i></button>
                                </div>
                                <div v-else @click="$refs.bannerFileInput.click()" style="cursor: pointer;"
                                    class="h-40 w-full rounded-lg bg-slate-50 dark:bg-slate-700 border-2 border-dashed border-slate-300 dark:border-slate-600 flex flex-col items-center justify-center text-slate-400">
                                    <i class="fa-regular fa-image text-3xl mb-2"></i>
                                    <span class="text-sm">Selecciona una imagen</span>
                                </div>

                                <!-- Mini Media Gallery Toggle -->
                                <button @click="showMediaSelector = !showMediaSelector"
                                    class="text-sm text-primary hover:underline font-medium flex items-center">
                                    <i class="fa-solid fa-images mr-2"></i>
                                    {{ showMediaSelector ? 'Ocultar librería' : 'Seleccionar de la librería' }}
                                </button>

                                <!-- Mini Gallery Grid -->
                                <div v-if="showMediaSelector"
                                    class="border rounded-lg p-2 h-80 overflow-y-auto bg-slate-50 dark:bg-slate-900 dark:border-slate-600 grid grid-cols-4 gap-2">
                                    <div v-for="img in mediaFiles.filter(f => !isVideo(f.name))" :key="img.name"
                                        @click="selectBannerImage(img.url)"
                                        class="aspect-square rounded  cursor-pointer border border-transparent hover:border-primary">
                                        <img :src="img.url" class="w-full h-full object-cover">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Título</label>
                            <input v-model="bannerForm.title" type="text"
                                class="w-full px-4 py-2 border dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Descripción
                                (Opcional)</label>
                            <textarea v-model="bannerForm.description" rows="2"
                                class="w-full px-4 py-2 border dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary outline-none"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label
                                    class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Caducidad</label>
                                <input v-model="bannerForm.expiresAt" type="date"
                                    class="w-full px-4 py-2 border dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary outline-none">
                            </div>
                            <div class="flex items-center pt-6">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="bannerForm.active" class="sr-only peer">
                                    <div
                                        class="relative w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/30 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                    </div>
                                    <span
                                        class="ms-3 text-sm font-medium text-slate-700 dark:text-slate-300">Activo</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div
                        class="p-6 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3 mt-auto">
                        <button @click="showBannerModal = false"
                            class="px-5 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">Cancelar</button>
                        <button @click="saveBanner"
                            class="px-5 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primaryDark">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- MODAL PRODUCTOS -->
            <div v-if="showProductModal"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
                <div
                    class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full md:w-full max-w-2xl overflow-hidden animate-fade-in border dark:border-slate-700 flex flex-col max-h-[90vh]">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800 dark:text-white">{{ editingProduct ? 'Editar' :
                            'Nuevo'
                            }} Producto</h3>
                        <button @click="showProductModal = false" class="text-slate-400 hover:text-red-500"><i
                                class="fa-solid fa-xmark text-xl"></i></button>
                    </div>

                    <div class="p-6 space-y-4 overflow-y-auto">
                        <!-- Imagen Producto -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Imagen del
                                Producto</label>
                            <div class="flex flex-col md:flex-row gap-4">
                                <div
                                    class="h-32 w-32 shrink-0 rounded-lg bg-slate-100 dark:bg-slate-700 overflow-hidden relative group border border-slate-200 dark:border-slate-600">
                                    <img v-if="productForm.image" :src="productForm.image"
                                        class="w-full h-full object-cover">
                                    <div v-else class="w-full h-full flex items-center justify-center text-slate-400"><i
                                            class="fa-solid fa-image text-2xl"></i></div>
                                    <button v-if="productForm.image" @click="deleteImagePreviewProd()"
                                        class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center"><i
                                            class="fa-solid fa-xmark text-xs"></i></button>
                                </div>
                                <div class="flex flex-col justify-center space-y-2">
                                    <button @click="showMediaSelector = !showMediaSelector"
                                        class="text-sm text-primary hover:underline font-medium text-left"><i
                                            class="fa-solid fa-images mr-1"></i> Seleccionar de librería</button>
                                    <div class="relative">
                                        <input type="file" ref="productFileInput" @change="uploadProductImage"
                                            class="hidden" accept="image/*">
                                        <button @click="$refs.productFileInput.click()"
                                            class="text-sm text-secondary hover:underline font-medium text-left">
                                            <i class="fa-solid fa-cloud-arrow-up mr-1"></i> <span
                                                v-if="isUploadingProductImg">Subiendo...</span><span v-else>Subir nueva
                                                imagen</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Mini librería -->
                            <div v-if="showMediaSelector"
                                class="mt-3 border rounded-lg p-2 h-80 overflow-y-auto bg-slate-50 dark:bg-slate-900 grid grid-cols-4 gap-2">
                                <div v-for="img in mediaFiles.filter(f => !isVideo(f.name))" :key="img.name"
                                    @click="selectProductImage(img.url)"
                                    class="aspect-square rounded  cursor-pointer border border-transparent hover:border-primary">
                                    <img :src="img.url" class="w-full h-full object-cover">
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label
                                    class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Nombre</label>
                                <input v-model="productForm.name" type="text"
                                    class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Precio
                                    ($)</label>
                                <input v-model="productForm.price" type="number"
                                    class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                            </div>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Descripción</label>
                            <textarea v-model="productForm.description" rows="2"
                                class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white"></textarea>
                        </div>

                        <!-- Relaciones: Categorías -->
                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Categorías</label>
                            <select multiple v-model="productForm.categories"
                                class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white h-24">
                                <option v-for="cat in availableCategories" :key="cat._id" :value="cat._id">{{ cat.name
                                    }}
                                </option>
                            </select>
                            <p class="text-xs text-slate-400 mt-1">Mantén presionado Ctrl (Windows) o Cmd (Mac) para
                                seleccionar varias.</p>
                        </div>

                        <!-- Relaciones: Addons -->
                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Complementos
                                Ligados</label>
                            <div
                                class="grid grid-cols-2 gap-2 bg-slate-50 dark:bg-slate-900 p-3 rounded-lg border border-slate-200 dark:border-slate-600 max-h-32 overflow-y-auto">
                                <label v-for="addon in availableAddons" :key="addon._id"
                                    class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" :value="addon._id" v-model="productForm.addons"
                                        class="rounded text-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-500">
                                    <span class="text-sm text-slate-600 dark:text-slate-300">{{ addon.name }}</span>
                                </label>
                            </div>
                        </div>

                        <div class="flex items-center pt-2">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="productForm.active" class="sr-only peer">
                                <div
                                    class="relative w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/30 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                </div>
                                <span class="ms-3 text-sm font-medium text-slate-700 dark:text-slate-300">Producto
                                    Activo</span>
                            </label>
                        </div>
                    </div>

                    <div
                        class="p-6 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3 mt-auto">
                        <button @click="showProductModal = false"
                            class="px-5 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">Cancelar</button>
                        <button @click="saveProduct"
                            class="px-5 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primaryDark">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- MODAL COMPLEMENTOS / ADDONS -->
            <div v-if="showAddonModal"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
                <div
                    class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full md:w-full max-w-lg overflow-hidden animate-fade-in border dark:border-slate-700 flex flex-col max-h-[90vh]">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800 dark:text-white">{{ editingAddon ? 'Editar' :
                            'Nuevo' }}
                            Grupo de Opciones</h3>
                        <button @click="showAddonModal = false" class="text-slate-400 hover:text-red-500"><i
                                class="fa-solid fa-xmark text-xl"></i></button>
                    </div>

                    <div class="p-6 space-y-6 overflow-y-auto">
                        <!-- Configuración General -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Nombre
                                    del
                                    Grupo</label>
                                <input v-model="addonForm.name" type="text" placeholder="Ej: Salsas, Bebidas"
                                    class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Máximo
                                    a
                                    elegir</label>
                                <input v-model="addonForm.maxOptions" type="number" min="1"
                                    class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div class="flex items-center pt-6">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="addonForm.required" class="sr-only peer">
                                    <div
                                        class="relative w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/30 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500">
                                    </div>
                                    <span class="ms-3 text-sm font-medium text-slate-700 dark:text-slate-300">¿Es
                                        Obligatorio?</span>
                                </label>
                            </div>
                        </div>

                        <!-- Lista de Opciones Dinámica -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300">Opciones del
                                    Grupo</label>
                                <button @click="addOptionRow"
                                    class="text-xs bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 px-3 py-1 rounded hover:bg-indigo-100 transition font-medium">
                                    <i class="fa-solid fa-plus mr-1"></i> Agregar Opción
                                </button>
                            </div>

                            <div
                                class="bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-600 overflow-hidden">
                                <div class="max-h-60 overflow-y-auto p-2 space-y-2">
                                    <div v-for="(opt, index) in addonForm.options" :key="index"
                                        class="flex items-center gap-2">
                                        <div class="flex-1">
                                            <input v-model="opt.name" type="text" placeholder="Nombre opción"
                                                class="w-full px-3 py-2 text-sm border rounded-lg bg-white dark:bg-slate-700 dark:border-slate-500 dark:text-white focus:outline-none focus:border-primary">
                                        </div>
                                        <div class="w-24">
                                            <div class="relative">
                                                <span class="absolute left-2 top-2 text-slate-400 text-sm">$</span>
                                                <input v-model="opt.priceExtra" type="number" placeholder="0"
                                                    class="w-full pl-6 pr-2 py-2 text-sm border rounded-lg bg-white dark:bg-slate-700 dark:border-slate-500 dark:text-white focus:outline-none focus:border-primary">
                                            </div>
                                        </div>
                                        <button @click="removeOptionRow(index)"
                                            class="w-9 h-9 flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition">
                                            <i class="fa-solid fa-trash-can"></i>
                                        </button>
                                    </div>
                                    <div v-if="addonForm.options.length === 0"
                                        class="text-center py-4 text-slate-400 text-sm italic">
                                        Agrega opciones para que el cliente elija.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="p-6 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3 mt-auto">
                        <button @click="showAddonModal = false"
                            class="px-5 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">Cancelar</button>
                        <button @click="saveAddon"
                            class="px-5 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primaryDark">Guardar
                            Grupo</button>
                    </div>
                </div>
            </div>

            <!-- MODAL CATEGORÍAS -->
            <div v-if="showCategoryModal"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
                <div
                    class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full md:w-full max-w-2xl overflow-hidden animate-fade-in border dark:border-slate-700">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800 dark:text-white">{{ editingCategory ? 'Editar' :
                            'Nueva'
                            }} Categoría</h3>
                        <button @click="showCategoryModal = false" class="text-slate-400 hover:text-red-500"><i
                                class="fa-solid fa-xmark text-xl"></i></button>
                    </div>

                    <div class="p-6 space-y-4">
                        <!-- Imagen Categoría -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Imagen
                                (Opcional)</label>
                            <div class="flex gap-4 items-center">
                                <div
                                    class="h-32 w-32 shrink-0 rounded-lg bg-slate-100 dark:bg-slate-700 overflow-hidden relative group border border-slate-200 dark:border-slate-600">
                                    <img v-if="categoryForm.image" :src="categoryForm.image"
                                        class="w-full h-full object-cover">
                                    <div v-else class="w-full h-full flex items-center justify-center text-slate-400"><i
                                            class="fa-solid fa-image text-xl"></i></div>
                                    <button v-if="categoryForm.image" @click="deleteImagePreviewCats()"
                                        class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center"><i
                                            class="fa-solid fa-xmark text-[10px]"></i></button>
                                </div>
                                <div class="flex flex-col space-y-2">
                                    <button @click="showMediaSelector = !showMediaSelector"
                                        class="text-sm text-primary hover:underline font-medium text-left"><i
                                            class="fa-solid fa-images mr-1"></i> De librería</button>
                                    <div class="relative">
                                        <input type="file" ref="categoryFileInput" @change="uploadCategoryImage"
                                            class="hidden" accept="image/*">
                                        <button @click="$refs.categoryFileInput.click()"
                                            class="text-sm text-secondary hover:underline font-medium text-left">
                                            <i class="fa-solid fa-cloud-arrow-up mr-1"></i> <span
                                                v-if="isUploadingCatImg">Subiendo...</span><span v-else>Subir
                                                nueva</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Mini librería -->
                            <div v-if="showMediaSelector"
                                class="mt-3 border rounded-lg p-2 h-80 overflow-y-auto bg-slate-50 dark:bg-slate-900 grid grid-cols-4 gap-2">
                                <div v-for="img in mediaFiles.filter(f => !isVideo(f.name))" :key="img.name"
                                    @click="selectCategoryImage(img.url)"
                                    class="aspect-square rounded cursor-pointer border border-transparent hover:border-primary">
                                    <img :src="img.url" class="w-full h-full object-cover">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Nombre</label>
                            <input v-model="categoryForm.name" type="text"
                                class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Descripción</label>
                            <textarea v-model="categoryForm.description" rows="2"
                                class="w-full px-4 py-2 border rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                        </div>
                        <div class="flex items-center pt-2">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="categoryForm.active" class="sr-only peer">
                                <div
                                    class="relative w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/30 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                </div>
                                <span class="ms-3 text-sm font-medium text-slate-700 dark:text-slate-300">Categoría
                                    Visible</span>
                            </label>
                        </div>
                    </div>

                    <div
                        class="p-6 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                        <button @click="showCategoryModal = false"
                            class="px-5 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">Cancelar</button>
                        <button @click="saveCategory"
                            class="px-5 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primaryDark">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="../assets/js/admin/app.js" type="module" async></script>
</body>

</html>