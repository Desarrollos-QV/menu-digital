<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regístrate - Menú Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>body { font-family: 'Outfit', sans-serif; }</style>
</head>
<body class="bg-slate-900 flex items-center justify-center min-h-screen p-4" style="background-image: url('../assets/images/background.jpg');background-position: center center;background-repeat: repeat-x;background-size: contain;">

<div id="app" class="w-full max-w-md">
    <!-- Formulario -->
    <div class="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 p-8">
        <!-- Logo / Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-600 text-white mb-4 shadow-lg shadow-indigo-500/30">
            <img src="../assets/images/logo.jpg" alt="logo" class="rounded-full">
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">Crea tu Menú Digital</h1>
            <p class="text-slate-400">Comienza gratis en segundos.</p>
        </div>

        <form @submit.prevent="register">
            
            <div class="space-y-5">
                <!-- Nombre del Negocio -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1.5">Nombre de tu Negocio</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-slate-500"><i class="fa-solid fa-store"></i></span>
                        <input v-model="form.businessName" type="text" placeholder="Ej: Tacos El Primos" class="w-full bg-slate-900 border border-slate-600 rounded-lg py-2.5 pl-10 pr-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition" required>
                    </div>
                </div>

                <!-- Usuario -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1.5">Usuario Admin</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-slate-500"><i class="fa-solid fa-user"></i></span>
                        <input v-model="form.username" type="text" placeholder="Ej: admin_tacos" class="w-full bg-slate-900 border border-slate-600 rounded-lg py-2.5 pl-10 pr-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition" required>
                    </div>
                </div>

                <!-- Email -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1.5">Correo electrónico</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-slate-500"><i class="fa-solid fa-user"></i></span>
                        <input v-model="form.email" type="email" placeholder="Ej: admin_tacos@gmail.com" class="w-full bg-slate-900 border border-slate-600 rounded-lg py-2.5 pl-10 pr-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition" required>
                    </div>
                </div>

                <!-- Contraseña -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1.5">Contraseña</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-slate-500"><i class="fa-solid fa-lock"></i></span>
                        <input v-model="form.password" type="password" placeholder="••••••••" class="w-full bg-slate-900 border border-slate-600 rounded-lg py-2.5 pl-10 pr-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition" required>
                    </div>
                </div>

                <!-- Plan Info -->
                <div class="bg-indigo-900/30 border border-indigo-500/30 rounded-lg p-3 flex items-start space-x-3">
                    <i class="fa-solid fa-gift text-indigo-400 mt-1"></i>
                    <div>
                        <p class="text-sm font-bold text-indigo-200">Plan Gratuito Incluido</p>
                        <p class="text-xs text-indigo-300/80">Podrás subir productos y recibir pedidos ilimitados con publicidad.</p>
                    </div>
                </div>

                <!-- Botón -->
                <button type="submit" :disabled="loading" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-lg shadow-lg shadow-indigo-500/20 transition transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center">
                    <span v-if="loading"><i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Creando cuenta...</span>
                    <span v-else>Registrarme</span>
                </button>
            </div>

            <!-- Error Message -->
            <p v-if="errorMsg" class="mt-4 text-sm text-red-400 text-center bg-red-900/20 py-2 rounded">{{ errorMsg }}</p>

        </form>
    </div>

    <p class="text-center text-slate-500 text-sm mt-6">
        ¿Ya tienes cuenta? <a href="/admin" class="text-indigo-400 hover:text-indigo-300 font-medium">Inicia Sesión</a>
    </p>

</div>

<script>
    const { createApp, ref } = Vue;

    createApp({
        setup() {
            const form = ref({ businessName: '', username: '', email: '', password: '' });
            const loading = ref(false);
            const errorMsg = ref('');

            const register = async () => {
                loading.value = true;
                errorMsg.value = '';

                try {
                    console.log(JSON.stringify(form.value));
                    const res = await fetch('/api/public/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(form.value)
                    });

                    const data = await res.json();

                    if (!res.ok) {
                        throw new Error(data.message || 'Error al registrar');
                    }

                    // Éxito: Redirigir al admin con mensaje (o auto-login si quisieras implementarlo)
                    alert('¡Cuenta creada con éxito! Ahora inicia sesión.');
                    window.location.href = '/admin';

                } catch (e) {
                    errorMsg.value = e.message;
                } finally {
                    loading.value = false;
                }
            };

            return { form, loading, errorMsg, register };
        }
    }).mount('#app');
</script>
</body>
</html>